<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ’• SÄ±la & Fatih - Bizim Hikayemiz ğŸ’•</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#0a0a1a;display:flex;justify-content:center;align-items:center;min-height:100vh;font-family:'Press Start 2P',monospace;overflow:hidden;}
canvas{border:4px solid #ff4081;border-radius:4px;box-shadow:0 0 30px rgba(255,64,129,0.4),0 0 60px rgba(255,64,129,0.1);image-rendering:pixelated;}
#hud{display:flex;justify-content:space-between;width:800px;padding:4px 8px;color:#ff80ab;font-size:9px;min-height:20px;}
</style>
</head>
<body>
<div style="display:flex;flex-direction:column;align-items:center;">
<div id="hud"><span id="hL"></span><span id="hC"></span><span id="hR"></span></div>
<canvas id="c" width="800" height="500"></canvas>
</div>
<script>
const canvas=document.getElementById('c'),ctx=canvas.getContext('2d'),W=800,H=500;
const PX=2;
const FS=1.7,SS=1.5;
const FH=Math.ceil(26*PX*FS),FW=Math.ceil(16*PX*FS);
const SH=Math.ceil(25*PX*SS);
const GRAV=0.6,JUMP=-12.5,SPD=4.5;
const SK='#D2956A',SD='#B87A52',HB='#1a1a1a',HD='#2a1a0a',GL='#3a3a3a';
const RD='#E03030',WH='#fff',DB='#1a1a1a',DG='#2a5a2a',DR='#8a2a2a';
const DGo='#c8a830',JN='#6888a8',JD='#506878',SH_='#2a2a2a',LP='#cc4444',NK='#dd3333';
function px(x,y,c){ctx.fillStyle=c;ctx.fillRect(x*PX,y*PX,PX,PX);}
function rc(x,y,w,h,c){ctx.fillStyle=c;ctx.fillRect(x*PX,y*PX,w*PX,h*PX);}

function drawFatih(ox,oy,scale,face,frame,outfit){
ctx.save();ctx.translate(ox,oy);ctx.scale(scale,scale);
if(face==='left'){ctx.scale(-1,1);ctx.translate(-16*PX,0);}
rc(4,0,9,2,HD);rc(3,1,11,2,HD);rc(3,2,11,2,HD);rc(4,3,10,1,HD);
px(3,0,HD);px(13,0,HD);px(14,1,HD);px(2,2,HD);px(14,2,HD);px(14,3,HD);
rc(4,4,9,7,SK);rc(3,5,1,4,SK);rc(13,4,1,4,HD);px(3,4,HD);
px(6,6,'#222');px(7,6,'#222');px(10,6,'#222');px(11,6,'#222');
rc(6,5,2,1,HD);rc(10,5,2,1,HD);
rc(6,8,5,1,HD);rc(5,9,7,1,HD);px(7,10,SD);px(8,10,SD);px(9,10,SD);
if(outfit==='actor'){
rc(3,11,11,7,'#111');rc(2,11,1,5,'#111');rc(14,11,1,5,'#111');rc(1,12,2,3,'#111');rc(14,12,2,3,'#111');
rc(7,11,3,4,WH);px(7,12,'#cc2222');px(8,12,'#dd3333');px(9,12,'#cc2222');
rc(3,18,5,6,'#1a1a1a');rc(9,18,5,6,'#1a1a1a');rc(3,24,5,2,'#222');rc(9,24,5,2,'#222');
}else if(outfit==='rich'){
rc(3,11,11,7,'#1a1a3a');rc(2,11,1,5,'#1a1a3a');rc(14,11,1,5,'#1a1a3a');rc(1,12,2,3,'#1a1a3a');rc(14,12,2,3,'#1a1a3a');
rc(7,11,3,4,'#ddd');px(7,12,'#993322');px(8,12,'#aa4433');px(9,12,'#993322');
rc(3,18,5,6,'#222');rc(9,18,5,6,'#222');rc(3,24,5,2,'#1a1a1a');rc(9,24,5,2,'#1a1a1a');
}else{
rc(3,11,11,7,RD);rc(2,11,1,5,RD);rc(14,11,1,5,RD);rc(1,12,2,3,RD);rc(14,12,2,3,RD);
px(5,13,WH);px(5,14,WH);px(5,15,WH);px(6,13,WH);
px(7,13,WH);px(7,14,WH);px(7,15,WH);px(8,15,WH);px(8,13,WH);px(8,14,WH);
px(9,13,WH);px(9,14,WH);px(9,15,WH);px(10,14,WH);
px(11,13,WH);px(11,14,WH);px(11,15,WH);px(12,14,WH);px(12,15,WH);px(13,13,WH);px(13,14,WH);
rc(3,18,5,6,JN);rc(9,18,5,6,JN);px(8,18,JD);px(8,19,JD);px(8,20,JD);
rc(3,24,5,2,SH_);rc(9,24,5,2,SH_);
}
const ao=frame%2===0?0:1;rc(0,13+ao,2,4,SK);rc(15,13-ao,2,4,SK);rc(2,25,1,1,SH_);rc(14,25,1,1,SH_);
ctx.restore();}

function drawSila(ox,oy,scale,face,frame,outfit){
ctx.save();ctx.translate(ox,oy);ctx.scale(scale,scale);
if(face==='left'){ctx.scale(-1,1);ctx.translate(-16*PX,0);}
rc(3,0,10,2,HB);rc(2,1,12,2,HB);rc(2,3,12,2,HB);rc(1,4,2,6,HB);rc(13,4,2,6,HB);rc(3,3,4,1,HB);
rc(3,4,10,7,SK);rc(4,6,3,2,GL);rc(9,6,3,2,GL);rc(7,6,2,1,GL);
px(5,6,'#aabbcc');px(10,6,'#aabbcc');px(5,7,'#222');px(10,7,'#222');
px(5,5,HB);px(6,5,HB);px(10,5,HB);px(11,5,HB);
px(6,9,LP);px(7,10,LP);px(8,10,LP);px(9,10,LP);px(10,9,LP);
px(7,9,WH);px(8,9,WH);px(9,9,WH);
for(let i=5;i<=10;i++)px(i,11,NK);px(7,12,NK);px(8,12,NK);
if(outfit==='designer'){
rc(3,12,10,9,'#2a2a5a');rc(2,12,1,6,'#2a2a5a');rc(13,12,1,6,'#2a2a5a');
px(5,12,'#3a3a7a');px(6,12,'#3a3a7a');px(10,12,'#3a3a7a');px(11,12,'#3a3a7a');
px(6,13,'#3a3a7a');px(10,13,'#3a3a7a');rc(7,12,2,5,WH);rc(3,17,10,4,'#2a2a5a');
}else if(outfit==='rich'){
rc(3,12,10,9,'#6a2040');rc(2,12,1,6,'#6a2040');rc(13,12,1,6,'#6a2040');
px(5,13,'#8a3060');px(7,14,'#8a3060');px(10,13,'#8a3060');px(4,16,'#8a3060');
px(8,16,'#aa8830');px(11,15,'#aa8830');px(6,18,'#aa8830');
rc(3,12,2,1,SK);rc(11,12,2,1,SK);
}else{
rc(3,12,10,9,DB);rc(2,12,1,6,DB);rc(13,12,1,6,DB);
px(4,13,DG);px(5,14,DR);px(6,13,DGo);px(8,14,DG);px(10,13,DR);px(11,14,DGo);
px(4,16,DR);px(6,17,DG);px(8,16,DGo);px(10,17,DG);px(5,18,DGo);px(9,18,DR);
px(7,19,DG);px(11,16,DR);px(4,19,DGo);px(12,15,DG);px(3,15,DR);
rc(3,12,2,1,SK);rc(11,12,2,1,SK);
}
const ao=frame%2===0?0:1;rc(0,13+ao,3,4,SK);rc(13,13-ao,3,4,SK);
rc(4,21,3,2,SK);rc(9,21,3,2,SK);rc(3,23,4,2,SH_);rc(9,23,4,2,SH_);rc(2,24,1,1,SH_);rc(13,24,1,1,SH_);
ctx.restore();}

function drawBoy(ox,oy,scale,v){
ctx.save();ctx.translate(ox,oy);ctx.scale(scale,scale);
const hcs=['#FFD700','#8B4513','#FF6600'],scs=['#00AA00','#0066CC','#AA00AA'];
rc(4,0,8,3,hcs[v%3]);rc(3,1,2,2,hcs[v%3]);rc(11,0,2,3,hcs[v%3]);px(5,0,hcs[v%3]);px(8,0,hcs[v%3]);
rc(4,3,8,6,SK);rc(3,4,1,3,SK);px(5,5,'#222');px(9,5,'#222');px(6,7,'#222');px(7,7,'#222');px(8,7,'#222');
rc(3,9,10,5,scs[v%3]);rc(2,9,1,4,scs[v%3]);rc(13,9,1,4,scs[v%3]);
rc(0,10,3,3,SK);rc(13,10,3,3,SK);rc(3,14,4,4,'#333');rc(8,14,5,4,'#333');
rc(4,18,3,2,SK);rc(9,18,3,2,SK);rc(3,20,4,2,'#eee');rc(9,20,4,2,'#eee');px(4,20,'#dd2222');px(10,20,'#dd2222');
ctx.restore();}
const BS=1.3,BH=Math.ceil(22*PX*BS);

// ===== KILIM BAG PIXEL ART =====
function drawKilimBag(ox,oy,scale){
ctx.save();ctx.translate(ox,oy);ctx.scale(scale,scale);
const s=2;
function r(x,y,w,h,c){ctx.fillStyle=c;ctx.fillRect(x*s,y*s,w*s,h*s);}
function p(x,y,c){ctx.fillStyle=c;ctx.fillRect(x*s,y*s,s,s);}
// Bag body
r(0,8,40,22,'#2a1a0a');
r(1,9,38,20,'#1a0a00');
// Kilim patterns - geometric triangles
const cols=['#cc3322','#dd6622','#3a6a2a','#aa3322','#cc8822','#2a4a1a'];
// Row 1 - top triangles
for(let i=0;i<8;i++){
  const c=cols[i%cols.length];
  const bx=2+i*5;
  p(bx+2,10,c);p(bx+1,11,c);p(bx+2,11,c);p(bx+3,11,c);
  p(bx,12,c);p(bx+1,12,c);p(bx+2,12,c);p(bx+3,12,c);p(bx+4,12,c);
}
// Row 2 - diamonds
for(let i=0;i<6;i++){
  const c=cols[(i+2)%cols.length];
  const bx=4+i*6;
  p(bx+2,15,c);p(bx+1,16,c);p(bx+2,16,c);p(bx+3,16,c);
  p(bx,17,c);p(bx+1,17,c);p(bx+2,17,c);p(bx+3,17,c);p(bx+4,17,c);
  p(bx+1,18,c);p(bx+2,18,c);p(bx+3,18,c);p(bx+2,19,c);
}
// Row 3 - bottom zigzag
for(let i=0;i<10;i++){
  const c=cols[(i+1)%cols.length];
  p(2+i*4,22,c);p(3+i*4,21,c);p(4+i*4,22,c);
}
// Gold accent dots
for(let i=0;i<7;i++){p(3+i*5,14,DGo);p(5+i*5,20,DGo);}
// Leather tag
r(14,13,12,5,'#aa7744');r(15,14,10,3,'#cc9966');
ctx.fillStyle='#5a3a1a';ctx.font='4px "Press Start 2P"';
ctx.fillText('SILA',16*s,16.5*s);
// Strap
r(0,5,40,3,'#cc3322');
// Strap pattern
for(let i=0;i<10;i++){
  p(2+i*4,5,'#2255aa');p(3+i*4,6,DGo);p(4+i*4,5,'#3a6a2a');p(2+i*4,7,'#cc8822');
}
// Strap hardware
r(0,4,3,2,'#888');r(37,4,3,2,'#888');
// Small pouch on left
r(-3,12,6,10,'#1a0a00');
for(let i=0;i<2;i++){p(-2+i*2,14,cols[i]);p(-1+i*2,16,cols[i+2]);}
// Zipper line
r(1,8,38,1,'#333');
ctx.restore();
}

function drawHeart(x,y,sz,col){
ctx.save();ctx.translate(x,y);ctx.fillStyle=col;
ctx.beginPath();ctx.moveTo(0,sz*0.3);
ctx.bezierCurveTo(-sz/2,-sz*0.3,-sz,sz*0.2,0,sz);
ctx.bezierCurveTo(sz,sz*0.2,sz/2,-sz*0.3,0,sz*0.3);
ctx.fill();ctx.restore();}

// ===== STATE =====
let state='title',sT=0,dI=0,aF=0,aT=0;
let particles=[];
let keys={};
let tr={a:false,al:0,tgt:'',fi:true};
document.addEventListener('keydown',e=>{keys[e.code]=true;if(e.code==='Space'||e.code==='Enter')e.preventDefault();handleInput(e.code);});
document.addEventListener('keyup',e=>{keys[e.code]=false;});

// ===== DIALOGS =====
const DLG={
mansion:[
  {w:'n',t:'2040 yÄ±lÄ±... Biz diyelim Istanbul siz diyin Londra, ZÃ¼rih, New York... BoÄŸaz manzaralÄ± bir malikane.'},
  {w:'n',t:'SÄ±la ve Fatih, baÅŸardÄ±klarÄ± her ÅŸeyin meyvesini topluyorlar.'},
  {w:'f',t:'AÅŸkÄ±m ya, manzara ÅŸaka mÄ±?'},
  {w:'s',t:'Bazen hÃ¢lÃ¢ rÃ¼ya gibi geliyor ğŸ˜Š'},
  {w:'f',t:'HatÄ±rlÄ±yor musun, o eski gÃ¼nleri?'},
  {w:'s',t:'100. yÄ±ldakÄ± allahÄ±n belasÄ± evleri diyosun demi'},
  {w:'f',t:'KÃ¼Ã§Ã¼cÃ¼k odalarda hayaller kuruyorduk...'},
  {w:'s',t:'Avrupa\'yÄ± gezmiÅŸtik, iÅŸ aramÄ±ÅŸtÄ±k, hobilerimizle uÄŸraÅŸmÄ±ÅŸtÄ±k...'},
  {w:'f',t:'Hadi o gÃ¼nlere bir daha dÃ¶nelim'},
  {w:'n',t:'[ ENTER ile 2026\'ya dÃ¶nelim... ]'},
],
flat:[
  {w:'n',t:'2026 yÄ±lÄ±... Ankara, 100. YÄ±l Ä°ÅŸÃ§i BloklarÄ±.'},
  {w:'n',t:'Fatih\'in kÃ¼Ã§Ã¼k Ã¶ÄŸrenci evi. Saat sabah 04:00.'},
  {w:'f',t:'AHHH! Alarm Ã§alÄ±yor! 6\'daki tren! GeÃ§ kalacaÄŸÄ±m! (sakin ol kanka)'},
  {w:'f',t:'SÄ±la EskiÅŸehir\'de bekliyor, onu almam lazÄ±m yoldan.'},
  {w:'f',t:'Ã‡antayÄ± kapÄ±p fÄ±rlÄ±yorum!Garda olmalÄ±yÄ±mm!'},
  {w:'n',t:'Fatih panikle hazÄ±rlanÄ±p garÄ±n yolunu tuttu...'},
  {w:'n',t:'04:30 - Ankara GarÄ±. Nefes nefese ama yetiÅŸti! (1 buÃ§uk saat trenin kalkmasÄ±nÄ± bekleyecek)'},
  {w:'n',t:'[ ENTER ile trene bin! ]'},
],
train:[
  {w:'n',t:'ğŸš‚ Ankara - EskiÅŸehir - Ä°stanbul HÄ±zlÄ± Tren'},
  {w:'n',t:'Fatih trene bindi. EskiÅŸehir duraÄŸÄ± yaklaÅŸÄ±yor...'},
  {w:'f',t:'Birazdan EskiÅŸehir... SÄ±la peronda bekliyordur.'},
  {w:'n',t:'Tren EskiÅŸehir\'e varÄ±yor...'},
  {w:'s',t:'AÅŸkÄ±m! BuradayÄ±m! ğŸ™‹â€â™€ï¸'},
  {w:'f',t:'Gel yavru'},
  {w:'s',t:'Parisian ablalarÄ± gÃ¶rcek miyiz peki'},
  {w:'n',t:'EVET HEPSÄ°NÄ° GÃ–RDÃœLER'},
  {w:'n',t:'[ ENTER ile devam et! ]'},
],
c1:[
  {w:'n',t:'âœˆï¸  BÃ–LÃœM 1: UÃ‡AÄA YETÄ°Å!'},
  {w:'n',t:'HavalimanÄ±nda uÃ§ak saati yaklaÅŸÄ±yor!'},
  {w:'f',t:'AÅŸkÄ±m koÅŸ, uÃ§aÄŸa yetiÅŸelim!'},
  {w:'s',t:'Bu liseli mal tayfa ne alaka ya'},
  {w:'n',t:'â† â†’ : KoÅŸ   SPACE : ZÄ±pla   UÃ§aÄŸa ulaÅŸ!'},
],
c2:[
  {w:'n',t:'ğŸ’¼  BÃ–LÃœM 2: Ä°Å AVI!'},
  {w:'f',t:'Ä°ÅŸ ilanlarÄ± havada uÃ§uÅŸuyor!'},
  {w:'s',t:'Ben de staj ilanÄ± arÄ±yorum! Yakala!'},
  {w:'n',t:'â† â†’ : KoÅŸ   SPACE : ZÄ±pla   12 ilan yakala!'},
],
c3:[
  {w:'n',t:'â­  BÃ–LÃœM 3: HAYALLERÄ°MÄ°Z GERÃ‡EK OLDU!'},
  {w:'f',t:'Sahnelerin Ã¼nlÃ¼ oyuncusu: FATÄ°H! ğŸ­'},
  {w:'s',t:'Ã–dÃ¼llÃ¼ designer: SILA! ğŸ¨'},
  {w:'n',t:'Birlikte yÄ±ldÄ±zlarÄ± toplayÄ±n! â­'},
],
ending:[
  {w:'n',t:'ğŸ’• Ve bÃ¶ylece...'},
  {w:'n',t:'Her zorluk, her macera onlarÄ± daha da gÃ¼Ã§lÃ¼ yaptÄ±.'},
  {w:'f',t:'Seninle geÃ§en her an bir hazine (falann)'},
  {w:'n',t:'Ä°yi ki varsÄ±n iyi ki birlikte bÃ¼yÃ¼dÃ¼k '},
  {w:'s',t:'Seni Ã§ok seviyorum.ğŸ’'},
  {w:'f',t:'Ben de seni Ã§ok seviyorum aÅŸkÄ±m! ğŸ’•'},
  {w:'n',t:'ğŸ‰ Sevgililer gÃ¼nÃ¼mÃ¼z kutlu olsun ğŸ‰'},
],
gift:[
  {w:'n',t:'HEY HEY HEY ğŸ Bir dakika... SÃ¼rpriz bitmedi!'},
  {w:'f',t:'SÄ±la, sana Ã¶zel bir hediyem var...'},
  {w:'n',t:'[ Devam etmek iÃ§in ENTER ]'},
]
};

// ===== 2040 MANSION SCENE =====
function drawMansion(){
const t=Date.now()*0.002;
// Night sky
const sg=ctx.createLinearGradient(0,0,0,H);
sg.addColorStop(0,'#050520');sg.addColorStop(0.4,'#0a0a30');sg.addColorStop(1,'#151040');
ctx.fillStyle=sg;ctx.fillRect(0,0,W,H);
// Stars
for(let i=0;i<60;i++){const a=0.3+0.5*(t+i);ctx.fillStyle=`rgba(255,255,255,${a})`;ctx.fillRect((i*113)%W,(i*67)%(H*0.35),1.5,1.5);}
// Moon
ctx.fillStyle='#FFE8C0';ctx.beginPath();ctx.arc(650,70,25,0,Math.PI*2);ctx.fill();
const mg=ctx.createRadialGradient(650,70,20,650,70,80);
mg.addColorStop(0,'rgba(255,232,192,0.12)');mg.addColorStop(1,'transparent');
ctx.fillStyle=mg;ctx.beginPath();ctx.arc(650,70,80,0,Math.PI*2);ctx.fill();
// Bosphorus water
ctx.fillStyle='#0a1535';ctx.fillRect(0,320,W,30);
for(let x=0;x<W;x+=8){const wy=325+Math.sin(t+x*0.02)*3;ctx.fillStyle='rgba(100,150,200,0.08)';ctx.fillRect(x,wy,6,2);}
// Moon reflection on water
ctx.fillStyle='rgba(255,232,192,0.04)';ctx.fillRect(620,320,60,30);
// Far city silhouette
ctx.fillStyle='#0a0a20';
for(let i=0;i<15;i++){const bx=i*55,bh=20+Math.sin(i*1.7)*15;ctx.fillRect(bx,320-bh,40,bh);}
// Bridge silhouette
ctx.strokeStyle='#1a1a3a';ctx.lineWidth=3;ctx.beginPath();ctx.moveTo(0,310);
ctx.quadraticCurveTo(400,280,W,310);ctx.stroke();
// Bridge cables
for(let i=0;i<8;i++){ctx.strokeStyle='rgba(255,200,100,0.05)';ctx.beginPath();ctx.moveTo(100+i*90,290);ctx.lineTo(100+i*90,310);ctx.stroke();}

// Mansion interior
ctx.fillStyle='#1a1020';ctx.fillRect(0,350,W,150);
// Marble floor
ctx.fillStyle='#2a2030';ctx.fillRect(0,380,W,120);
for(let x=0;x<W;x+=80){ctx.fillStyle='#322838';ctx.fillRect(x,380,75,120);}
ctx.fillStyle='rgba(255,220,180,0.03)';ctx.fillRect(0,380,W,2);

// Grand window (panoramic)
ctx.strokeStyle='#5a4050';ctx.lineWidth=8;ctx.strokeRect(50,180,700,140);
for(let i=1;i<5;i++){ctx.beginPath();ctx.moveTo(50+i*140,180);ctx.lineTo(50+i*140,320);ctx.stroke();}

// Chandelier
ctx.fillStyle='#aa8830';ctx.fillRect(380,160,8,25);
ctx.fillRect(360,185,48,4);
for(let i=0;i<5;i++){
  const cx=365+i*10;
  ctx.fillStyle='#aa8830';ctx.fillRect(cx,189,2,8);
  ctx.fillStyle='#FFD080';ctx.beginPath();ctx.arc(cx+1,199,3,0,Math.PI*2);ctx.fill();
}
const cg=ctx.createRadialGradient(384,195,5,384,220,120);
cg.addColorStop(0,'rgba(255,210,130,0.12)');cg.addColorStop(1,'transparent');
ctx.fillStyle=cg;ctx.beginPath();ctx.arc(384,220,120,0,Math.PI*2);ctx.fill();

// Luxury couch
ctx.fillStyle='#4a1828';ctx.fillRect(200,340,380,50);
ctx.fillStyle='#3a1220';ctx.fillRect(190,332,20,65);ctx.fillRect(570,332,20,65);
ctx.fillStyle='#5a2038';ctx.fillRect(215,345,80,30);ctx.fillRect(310,345,80,30);ctx.fillRect(405,345,80,30);
// Gold details
ctx.fillStyle='#aa8830';ctx.fillRect(200,340,380,2);ctx.fillRect(200,388,380,2);

// Side tables
ctx.fillStyle='#3a2a1a';ctx.fillRect(140,355,40,10);ctx.fillRect(150,365,8,20);ctx.fillRect(168,365,8,20);
ctx.fillRect(600,355,40,10);ctx.fillRect(610,365,8,20);ctx.fillRect(628,365,8,20);
// Vases
ctx.fillStyle='#4a4060';ctx.fillRect(152,340,16,16);ctx.fillStyle='#3a6a2a';ctx.fillRect(155,332,4,10);ctx.fillRect(160,335,4,7);ctx.fillRect(163,330,3,12);
ctx.fillStyle='#6a3040';ctx.fillRect(612,340,16,16);ctx.fillStyle='#cc3355';ctx.beginPath();ctx.arc(620,338,4,0,Math.PI*2);ctx.fill();

// Art on wall
ctx.fillStyle='#aa8830';ctx.fillRect(80,220,60,50);ctx.fillStyle='#2a3a5a';ctx.fillRect(84,224,52,42);
ctx.fillStyle='#aa8830';ctx.fillRect(660,220,60,50);ctx.fillStyle='#3a2a2a';ctx.fillRect(664,224,52,42);

// Wine glasses on table
ctx.fillStyle='rgba(200,50,80,0.5)';ctx.fillRect(155,353,5,3);ctx.fillRect(620,353,5,3);
ctx.fillStyle='#ccc';ctx.fillRect(156,348,3,5);ctx.fillRect(621,348,3,5);

// Characters on luxury couch
const cs=340;
drawSila(280,cs-SH+12,SS,'right',Math.floor(t)%2,'rich');
drawFatih(400,cs-FH+12,FS,'left',Math.floor(t)%2,'rich');

// Floating sparkles
for(let i=0;i<8;i++){
  const sx=200+i*60+Math.sin(t+i)*20,sy=300+Math.cos(t*0.7+i)*15;
  const a=0.08+Math.sin(t+i*2)*0.04;
  ctx.fillStyle=`rgba(255,215,0,${a})`;ctx.fillRect(sx,sy,2,2);
}
}

// ===== 2026 WORKER BLOCK APARTMENT =====
function drawFlat(){
const t=Date.now()*0.002;
// Wall - slightly worn
const wg=ctx.createLinearGradient(0,0,0,H);
wg.addColorStop(0,'#2a2520');wg.addColorStop(1,'#1a1510');
ctx.fillStyle=wg;ctx.fillRect(0,0,W,H);
// Wall texture cracks
ctx.strokeStyle='rgba(50,40,30,0.3)';ctx.lineWidth=1;
for(let i=0;i<5;i++){ctx.beginPath();ctx.moveTo(100+i*150,50+i*20);ctx.lineTo(120+i*150,80+i*30);ctx.stroke();}

// Floor - old parquet
ctx.fillStyle='#3a2a18';ctx.fillRect(0,370,W,130);
for(let x=0;x<W;x+=40){ctx.fillStyle=x%80===0?'#3a2a18':'#352515';ctx.fillRect(x,370,38,130);}

// Small window
ctx.fillStyle='#2a3050';ctx.fillRect(520,80,120,100);
// Daytime sky through window
ctx.fillStyle='#4a6a9a';ctx.fillRect(524,84,112,92);
// Apartment block visible outside
ctx.fillStyle='#7a7a7a';ctx.fillRect(550,100,30,76);ctx.fillRect(590,110,25,66);
ctx.fillStyle='#aab0c0';
for(let y=0;y<60;y+=12)for(let x=0;x<20;x+=10){ctx.fillRect(554+x,105+y,6,8);ctx.fillRect(594+x,115+y,5,7);}
// Window frame
ctx.strokeStyle='#5a4530';ctx.lineWidth=4;ctx.strokeRect(520,80,120,100);
ctx.beginPath();ctx.moveTo(580,80);ctx.lineTo(580,180);ctx.stroke();

// Cheap curtain
ctx.fillStyle='#6a5a40';ctx.fillRect(514,72,12,115);ctx.fillRect(642,72,12,115);

// Calendar on wall "2026"
ctx.fillStyle='#ddd';ctx.fillRect(420,100,40,35);ctx.fillStyle='#cc3333';ctx.fillRect(420,100,40,10);
ctx.fillStyle='#333';ctx.font='6px "Press Start 2P"';ctx.fillText('2026',424,128);ctx.fillText('ÅUB',428,108);

// Poster on wall (cheap frame)
ctx.fillStyle='#4a3a2a';ctx.fillRect(80,90,80,60);
ctx.fillStyle='#2a4a3a';ctx.fillRect(84,94,72,52);
ctx.fillStyle='#3a5a4a';ctx.font='5px "Press Start 2P"';ctx.fillText('ODTÃœ',98,118);

// Bookshelf (ikea style)
ctx.fillStyle='#8a7a60';ctx.fillRect(200,110,90,12);
ctx.fillStyle='#cc3333';ctx.fillRect(205,98,10,12);
ctx.fillStyle='#3366cc';ctx.fillRect(218,100,8,10);
ctx.fillStyle='#33aa55';ctx.fillRect(229,97,9,13);
ctx.fillStyle='#ddaa33';ctx.fillRect(241,99,8,11);
ctx.fillStyle='#aa4488';ctx.fillRect(252,98,10,12);
// Second shelf
ctx.fillStyle='#8a7a60';ctx.fillRect(200,150,90,12);
ctx.fillStyle='#777';ctx.fillRect(208,140,12,10);// mug
ctx.fillStyle='#444';ctx.fillRect(235,138,18,12);// laptop

// Old radiator
ctx.fillStyle='#bbb';ctx.fillRect(650,250,25,120);
for(let y=0;y<110;y+=12){ctx.fillStyle='#aaa';ctx.fillRect(650,255+y,25,8);}

// Simple sofa (not luxury)
ctx.fillStyle='#5a5040';ctx.fillRect(200,295,300,65);
ctx.fillStyle='#4a4035';ctx.fillRect(190,288,18,78);ctx.fillRect(492,288,18,78);
ctx.fillStyle='#6a6050';ctx.fillRect(215,300,80,30);ctx.fillRect(310,300,80,30);ctx.fillRect(405,300,80,30);
ctx.fillStyle='#4a4035';ctx.fillRect(195,360,15,8);ctx.fillRect(495,360,15,8);

// Small coffee table
ctx.fillStyle='#5a4530';ctx.fillRect(290,370,120,8);ctx.fillRect(300,378,6,15);ctx.fillRect(400,378,6,15);
// Tea glasses (Ã§ay)
ctx.fillStyle='rgba(180,80,20,0.7)';ctx.fillRect(320,364,6,6);ctx.fillRect(370,364,6,6);
ctx.fillStyle='#ccc';ctx.fillRect(319,363,8,2);ctx.fillRect(369,363,8,2);

// Shoes at door
ctx.fillStyle='#333';ctx.fillRect(20,385,14,6);ctx.fillRect(38,386,12,5);
ctx.fillStyle='#cc3333';ctx.fillRect(55,385,12,6);ctx.fillRect(70,386,10,5);

// Rug (simple)
ctx.fillStyle='rgba(150,80,60,0.2)';ctx.beginPath();ctx.ellipse(350,400,140,22,0,0,Math.PI*2);ctx.fill();

// Fatih alone, panicking
drawFatih(350,370-FH,FS,'right',Math.floor(t*3)%2,'normal');
// Panic sweat drops
const sw=Math.sin(t*4);
ctx.fillStyle='rgba(100,180,255,0.6)';
ctx.beginPath();ctx.arc(350+FW+3,370-FH+15+sw*2,2,0,Math.PI*2);ctx.fill();
ctx.beginPath();ctx.arc(350+FW+7,370-FH+20-sw*2,1.5,0,Math.PI*2);ctx.fill();
// "!!!" above head
if(Math.floor(t*2)%2){ctx.fillStyle='#ff4444';ctx.font='10px "Press Start 2P"';ctx.fillText('!!!',350+5,370-FH-8);}
}

// ===== TRAIN SCENE =====
function drawTrain(){
const t=Date.now()*0.002;
// Sky - early morning
const sg=ctx.createLinearGradient(0,0,0,H);
sg.addColorStop(0,'#1a2040');sg.addColorStop(0.3,'#2a3060');sg.addColorStop(0.6,'#4a4a80');sg.addColorStop(1,'#6a5a70');
ctx.fillStyle=sg;ctx.fillRect(0,0,W,H);
// Early sunrise glow
const srg=ctx.createRadialGradient(700,H*0.55,20,700,H*0.55,200);
srg.addColorStop(0,'rgba(255,180,100,0.12)');srg.addColorStop(1,'transparent');
ctx.fillStyle=srg;ctx.beginPath();ctx.arc(700,H*0.55,200,0,Math.PI*2);ctx.fill();
// Stars fading
for(let i=0;i<30;i++){const a=0.15+0.1*Math.sin(t+i);ctx.fillStyle=`rgba(255,255,255,${a})`;ctx.fillRect((i*113)%W,(i*53)%(H*0.3),1.5,1.5);}
// Distant hills scrolling
ctx.fillStyle='#1a2530';ctx.beginPath();ctx.moveTo(0,300);
for(let x=0;x<=W;x+=20){ctx.lineTo(x,280+Math.sin((x+t*30)*0.008)*25+Math.cos((x+t*20)*0.012)*15);}
ctx.lineTo(W,H);ctx.lineTo(0,H);ctx.fill();
// Fields
ctx.fillStyle='#1a2a15';ctx.fillRect(0,320,W,30);
ctx.fillStyle='#152010';ctx.fillRect(0,340,W,10);
// Railway tracks
ctx.fillStyle='#4a4a4a';ctx.fillRect(0,350,W,4);ctx.fillRect(0,364,W,4);
// Ties
ctx.fillStyle='#3a2a1a';for(let x=-t*15%20;x<W;x+=20)ctx.fillRect(x,348,12,22);
// Rails shine
ctx.fillStyle='rgba(200,200,200,0.15)';ctx.fillRect(0,350,W,1);ctx.fillRect(0,364,W,1);
// Ground below tracks
ctx.fillStyle='#2a2a2a';ctx.fillRect(0,370,W,130);
// Gravel
ctx.fillStyle='#3a3a3a';for(let x=0;x<W;x+=8)ctx.fillRect(x+Math.random()*4,370+Math.random()*8,3,2);

// Train body
const trainY=280;
// Locomotive front shape
ctx.fillStyle='#ddd';ctx.fillRect(80,trainY,600,72);
// Top curve
ctx.fillStyle='#ccc';ctx.fillRect(80,trainY-8,600,10);
// Blue stripe (TCDD style)
ctx.fillStyle='#2255aa';ctx.fillRect(80,trainY+15,600,8);
// Red stripe
ctx.fillStyle='#cc3333';ctx.fillRect(80,trainY+55,600,4);
// Windows
for(let i=0;i<8;i++){
  const wx=120+i*68;
  ctx.fillStyle='#1a2a4a';ctx.fillRect(wx,trainY+5,50,35);
  // Window frame
  ctx.strokeStyle='#aaa';ctx.lineWidth=1.5;ctx.strokeRect(wx,trainY+5,50,35);
  // Window reflection
  ctx.fillStyle='rgba(100,150,200,0.15)';ctx.fillRect(wx+2,trainY+7,20,15);
  // Warm light inside
  ctx.fillStyle='rgba(255,220,150,0.2)';ctx.fillRect(wx+2,trainY+20,46,18);
}
// Door
ctx.fillStyle='#bbb';ctx.fillRect(430,trainY+5,25,55);
ctx.fillStyle='#999';ctx.fillRect(441,trainY+5,2,55);
// Wheels
for(let i=0;i<6;i++){const wx=120+i*90;ctx.fillStyle='#444';ctx.beginPath();ctx.arc(wx,trainY+72,12,0,Math.PI*2);ctx.fill();ctx.fillStyle='#666';ctx.beginPath();ctx.arc(wx,trainY+72,6,0,Math.PI*2);ctx.fill();}
// "YHT" text
ctx.fillStyle='#2255aa';ctx.font='8px "Press Start 2P"';ctx.fillText('YHT',90,trainY+50);

// Ankara-EskiÅŸehir-Ä°stanbul route sign
ctx.fillStyle='rgba(0,0,0,0.7)';ctx.fillRect(250,trainY-30,300,18);
ctx.fillStyle='#ffcc00';ctx.font='7px "Press Start 2P"';
ctx.fillText('ANKARA â†’ ESKÄ°ÅEHÄ°R â†’ Ä°STANBUL',258,trainY-18);

// Characters visible through a window
// Determine scene phase from dialog
if(dI>=4){
  // Both SÄ±la and Fatih together
  drawFatih(310,trainY+8,0.8,'right',Math.floor(t)%2,'normal');
  drawSila(345,trainY+10,0.7,'left',Math.floor(t)%2,'normal');
  // Happy vibe - hearts
  for(let i=0;i<3;i++){
    const hx=330+Math.sin(t+i)*12,hy=trainY-5+Math.cos(t*0.8+i)*5;
    drawHeart(hx,hy,4,`rgba(255,128,180,${0.2+Math.sin(t+i)*0.1})`);
  }
}else{
  // Just Fatih alone
  drawFatih(320,trainY+8,0.8,'right',0,'normal');
  // SÄ±la on platform (EskiÅŸehir)
  if(dI>=3){
    drawSila(520,trainY+18,SS,'left',Math.floor(t)%2,'normal');
    // EskiÅŸehir station sign
    ctx.fillStyle='#ddd';ctx.fillRect(490,trainY-5,110,20);
    ctx.fillStyle='#2255aa';ctx.font='6px "Press Start 2P"';ctx.fillText('ESKÄ°ÅEHÄ°R',497,trainY+9);
    // SÄ±la waving
    ctx.fillStyle='#ff80ab';ctx.font='8px "Press Start 2P"';ctx.fillText('ğŸ‘‹',545,trainY+10);
  }
}

// Telephone poles passing
for(let i=0;i<4;i++){
  const px_=(i*220-t*15%220+220)%W-30;
  ctx.fillStyle='#4a3a2a';ctx.fillRect(px_,200,4,150);
  ctx.fillRect(px_-12,210,28,3);
  ctx.strokeStyle='#333';ctx.lineWidth=1;
  ctx.beginPath();ctx.moveTo(px_-12,211);ctx.quadraticCurveTo(px_+100,225,px_+200,211);ctx.stroke();
}
}

// ===== DIALOG BOX =====
function drawDlg(d){
if(!d)return;
ctx.fillStyle='rgba(10,5,20,0.92)';ctx.fillRect(40,H-130,W-80,110);
ctx.strokeStyle=d.w==='f'?'#80d0ff':d.w==='s'?'#ff80ab':'#aaa';
ctx.lineWidth=2;ctx.strokeRect(40,H-130,W-80,110);
if(d.w!=='n'){ctx.fillStyle=d.w==='f'?'#80d0ff':'#ff80ab';ctx.font='10px "Press Start 2P"';ctx.fillText(d.w==='f'?'FATÄ°H':'SILA',60,H-110);}
const mx=Math.floor(sT/2),dt=d.t.substring(0,mx);
ctx.fillStyle='#e0d0e8';ctx.font='11px "Press Start 2P"';
const words=dt.split(' ');let line='',ly=d.w==='n'?H-100:H-85;
words.forEach(w=>{const test=line+w+' ';if(ctx.measureText(test).width>W-140){ctx.fillText(line,60,ly);line=w+' ';ly+=22;}else line=test;});
ctx.fillText(line,60,ly);
if(mx>=d.t.length&&Math.floor(Date.now()/500)%2){ctx.fillStyle='#ff80ab';ctx.font='8px "Press Start 2P"';ctx.fillText('â–¼ ENTER',W-180,H-30);}
}

// ===== PARTICLES =====
function spawnP(x,y,col,n){for(let i=0;i<n;i++)particles.push({x,y,vx:(Math.random()-0.5)*5,vy:(Math.random()-0.5)*5-2,life:1,sz:2+Math.random()*3,col});}
function drawP(cx=0){particles=particles.filter(p=>p.life>0);particles.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.vy+=0.05;p.life-=0.02;ctx.globalAlpha=p.life;ctx.fillStyle=p.col;ctx.fillRect(p.x-cx,p.y,p.sz*p.life,p.sz*p.life);});ctx.globalAlpha=1;}

// ===== PLAYER PHYSICS =====
function updP(p,gY,pl){
if(keys['ArrowLeft']||keys['KeyA']){p.x-=SPD;p.face='left';p.rf+=0.15;}
else if(keys['ArrowRight']||keys['KeyD']){p.x+=SPD;p.face='right';p.rf+=0.15;}
if((keys['Space']||keys['ArrowUp']||keys['KeyW'])&&p.og){p.vy=JUMP;p.og=false;}
p.vy+=GRAV;p.y+=p.vy;if(p.x<0)p.x=0;
p.og=false;
pl.forEach(q=>{if(p.x+FW-10>q.x&&p.x+10<q.x+q.w&&p.y+FH>q.y&&p.y+FH<q.y+q.h+12&&p.vy>=0){p.y=q.y-FH;p.vy=0;p.og=true;}});}
function mkP(x,gY){return{x,y:gY-FH,vy:0,og:false,face:'right',rf:0};}

// ===== LEVEL 1 =====
let L1={};
function initL1(){const gY=H-90;L1={gY,cx:0,lW:4000,won:false,col:0,pl:[{x:0,y:gY,w:4200,h:100}],boys:[],suit:[],cl:[],p:mkP(60,gY),plane:{x:3800,y:200}};
for(let i=0;i<15;i++)L1.pl.push({x:300+i*240+Math.random()*60,y:gY-80-Math.random()*70,w:85+Math.random()*40,h:16});
for(let i=0;i<12;i++){const bx=400+i*290+Math.random()*80;L1.boys.push({x:bx,bx:bx,y:gY-BH,v:i%3,vx:(Math.random()>0.5?1:-1)*(0.4+Math.random()*0.5),rng:40+Math.random()*50});}
for(let i=0;i<10;i++)L1.suit.push({x:250+i*350+Math.random()*80,y:gY-40-Math.random()*80,c:false});
for(let i=0;i<8;i++)L1.cl.push({x:Math.random()*L1.lW,y:20+Math.random()*80,w:60+Math.random()*50});}
function updL1(){const p=L1.p;updP(p,L1.gY,L1.pl);if(p.x>L1.lW)p.x=L1.lW;
L1.boys.forEach(b=>{b.x+=b.vx;if(Math.abs(b.x-b.bx)>b.rng)b.vx*=-1;if(Math.abs(p.x+FW/2-b.x-16)<30&&Math.abs(p.y+FH/2-b.y-BH/2)<35){p.vy=-8;p.x+=p.face==='right'?-30:30;spawnP(p.x+FW/2,p.y+FH/2,'#ff4444',6);}});
L1.suit.forEach(s=>{if(s.c)return;if(Math.abs(p.x+FW/2-s.x-10)<28&&Math.abs(p.y+FH/2-s.y-8)<28){s.c=true;L1.col++;spawnP(s.x,s.y,'#ffaa00',8);}});
if(p.x>L1.plane.x-60&&!L1.won){L1.won=true;setTimeout(()=>startTr('c2'),1500);}
const tc=p.x-W/3;L1.cx+=(tc-L1.cx)*0.08;L1.cx=Math.max(0,Math.min(L1.cx,L1.lW-W));
document.getElementById('hL').textContent=`ğŸ§³ x ${L1.col}`;document.getElementById('hC').textContent='âœˆï¸ BÃ–LÃœM 1: UÃ‡AÄA YETÄ°Å!';document.getElementById('hR').textContent=`UÃ§ak: ${Math.max(0,Math.floor((L1.plane.x-p.x)/50))}m`;}
function drawL1(){const sg=ctx.createLinearGradient(0,0,0,H);sg.addColorStop(0,'#1a2a4a');sg.addColorStop(0.5,'#2a3a5a');sg.addColorStop(1,'#3a4a6a');ctx.fillStyle=sg;ctx.fillRect(0,0,W,H);
L1.cl.forEach(c=>{const sx=c.x-L1.cx*0.3;ctx.fillStyle='rgba(255,255,255,0.08)';ctx.beginPath();ctx.ellipse(sx,c.y,c.w/2,15,0,0,Math.PI*2);ctx.fill();});
ctx.fillStyle='#253050';ctx.fillRect(0,280,W,L1.gY-280);for(let x=20;x<W;x+=35){ctx.fillStyle='rgba(255,220,150,0.3)';ctx.fillRect(x-L1.cx*0.1%35,295,18,25);}
ctx.fillStyle='#4a4a5a';ctx.fillRect(0,L1.gY,W,H-L1.gY);ctx.fillStyle='#ccaa00';ctx.fillRect(0,L1.gY-3,W,3);
L1.pl.forEach((pl,i)=>{if(i===0)return;const sx=pl.x-L1.cx;if(sx>W+50||sx+pl.w<-50)return;ctx.fillStyle='#5a5a6a';ctx.fillRect(sx,pl.y,pl.w,pl.h);ctx.fillStyle='#7a7a8a';ctx.fillRect(sx,pl.y,pl.w,3);});
L1.suit.forEach(s=>{if(s.c)return;const sx=s.x-L1.cx;if(sx>W+30||sx<-30)return;const bob=Math.sin(Date.now()*0.003+s.x*0.01)*3;ctx.fillStyle='#cc6622';ctx.fillRect(sx,s.y+bob,20,16);ctx.fillStyle='#aa5511';ctx.fillRect(sx+2,s.y+bob+2,16,12);ctx.fillStyle='#ddaa00';ctx.fillRect(sx+8,s.y+bob-2,4,4);});
L1.boys.forEach(b=>{const sx=b.x-L1.cx;if(sx>W+50||sx<-50)return;drawBoy(sx,b.y,BS,b.v);if(Math.sin(Date.now()*0.0004+b.x*0.1)>0){ctx.fillStyle='rgba(255,255,255,0.9)';ctx.beginPath();ctx.ellipse(sx+12,b.y-12,22,10,0,0,Math.PI*2);ctx.fill();ctx.fillStyle='#333';ctx.font='6px "Press Start 2P"';ctx.fillText(['ÅŸayzee','aqq','SA','EYYY'][b.v%4],sx+1,b.y-9);}});
const plX=L1.plane.x-L1.cx;if(plX<W+100){ctx.fillStyle='#ccc';ctx.beginPath();ctx.ellipse(plX,L1.plane.y,80,25,0,0,Math.PI*2);ctx.fill();ctx.fillStyle='#aaa';ctx.beginPath();ctx.moveTo(plX-70,L1.plane.y);ctx.lineTo(plX-90,L1.plane.y-35);ctx.lineTo(plX-50,L1.plane.y);ctx.fill();ctx.fillStyle='#ff4081';ctx.font='10px "Press Start 2P"';ctx.fillText('PARIS âœˆï¸',plX-30,L1.plane.y-40);}
const sx=L1.p.x-L1.cx;drawFatih(sx,L1.p.y,FS,L1.p.face,Math.floor(L1.p.rf),'normal');drawSila(sx-45,L1.p.y+FH-SH,SS,L1.p.face,Math.floor(L1.p.rf),'normal');drawP(L1.cx);
if(L1.won){const a=Math.min(1,(sT-10)*0.02);ctx.fillStyle=`rgba(255,255,255,${a})`;ctx.font='18px "Press Start 2P"';ctx.textAlign='center';ctx.fillText('âœˆï¸ UÃ‡AÄA YETÄ°ÅTÄ°NÄ°Z!',W/2,H/2);ctx.textAlign='left';}}

// ===== LEVEL 2 =====
let L2={};
function initL2(){const gY=H-80;L2={gY,cx:0,lW:3500,won:false,col:0,target:12,pl:[{x:0,y:gY,w:3700,h:80}],jobs:[],bldg:[],p:mkP(60,gY)};
for(let i=0;i<16;i++)L2.pl.push({x:200+i*200+Math.random()*50,y:gY-70-Math.random()*100,w:75+Math.random()*40,h:16});
const jt=['SDR','BDR','Marketing','Design','Erasmus','Staj','Event Mgr','Sales','Tech Lead','Creative Dir','PM','UX Design'];
for(let i=0;i<20;i++)L2.jobs.push({x:200+i*160+Math.random()*60,y:100+Math.random()*200,vy:Math.sin(i)*0.5,vx:(Math.random()-0.5)*1.2,text:jt[i%jt.length],c:false});
for(let i=0;i<15;i++)L2.bldg.push({x:i*200+Math.random()*80,h:80+Math.random()*150,w:50+Math.random()*60,c:`hsl(${220+Math.random()*30},30%,${12+Math.random()*8}%)`});}
function updL2(){const p=L2.p;updP(p,L2.gY,L2.pl);if(p.x>L2.lW)p.x=L2.lW;
L2.jobs.forEach(j=>{if(j.c)return;j.y+=j.vy;j.x+=j.vx;if(j.y<50||j.y>350)j.vy*=-1;j.vy+=(Math.random()-0.5)*0.05;if(Math.abs(p.x+FW/2-j.x)<30&&Math.abs(p.y+FH/2-j.y)<30){j.c=true;L2.col++;spawnP(j.x,j.y,'#44ff88',10);}});
if(L2.col>=L2.target&&!L2.won){L2.won=true;setTimeout(()=>startTr('c3'),1500);}
const tc=p.x-W/3;L2.cx+=(tc-L2.cx)*0.08;L2.cx=Math.max(0,Math.min(L2.cx,L2.lW-W));
document.getElementById('hL').textContent=`ğŸ’¼ ${L2.col} / ${L2.target}`;document.getElementById('hC').textContent='ğŸ’¼ BÃ–LÃœM 2: Ä°Å AVI!';document.getElementById('hR').textContent='';}
function drawL2(){const sg=ctx.createLinearGradient(0,0,0,H);sg.addColorStop(0,'#1a1030');sg.addColorStop(0.4,'#2a1840');sg.addColorStop(1,'#3a2050');ctx.fillStyle=sg;ctx.fillRect(0,0,W,H);
for(let i=0;i<40;i++)ctx.fillRect((i*137+L2.cx*0.05)%W,(i*89)%(H*0.4),1.5,1.5);
L2.bldg.forEach(b=>{const sx=b.x-L2.cx*0.2;ctx.fillStyle=b.c;ctx.fillRect(sx,L2.gY-b.h,b.w,b.h);ctx.fillStyle='rgba(255,200,100,0.25)';for(let wy=10;wy<b.h-10;wy+=18)for(let wx=6;wx<b.w-6;wx+=14)if(Math.random()>0.2)ctx.fillRect(sx+wx,L2.gY-b.h+wy,7,9);});
ctx.fillStyle='#3a3a4a';ctx.fillRect(0,L2.gY,W,H-L2.gY);
L2.pl.forEach((pl,i)=>{if(i===0)return;const sx=pl.x-L2.cx;if(sx>W+50||sx+pl.w<-50)return;ctx.fillStyle='#4a4060';ctx.fillRect(sx,pl.y,pl.w,pl.h);ctx.fillStyle='#5a5080';ctx.fillRect(sx,pl.y,pl.w,3);});
L2.jobs.forEach(j=>{if(j.c)return;const sx=j.x-L2.cx;if(sx>W+60||sx<-60)return;const bob=Math.sin(Date.now()*0.003+j.x*0.01)*3;ctx.fillStyle='#fffff0';ctx.fillRect(sx-20,j.y+bob-12,44,28);ctx.fillStyle='#333';ctx.font='5px "Press Start 2P"';ctx.fillText(j.text,sx-16,j.y+bob+2);ctx.fillStyle='rgba(100,255,150,0.12)';ctx.beginPath();ctx.arc(sx,j.y+bob,22,0,Math.PI*2);ctx.fill();});
const sx=L2.p.x-L2.cx;drawFatih(sx,L2.p.y,FS,L2.p.face,Math.floor(L2.p.rf),'normal');drawSila(sx-45,L2.p.y+FH-SH,SS,L2.p.face,Math.floor(L2.p.rf),'normal');drawP(L2.cx);
if(L2.won){const a=Math.min(1,(sT-10)*0.02);ctx.fillStyle=`rgba(255,255,255,${a})`;ctx.font='16px "Press Start 2P"';ctx.textAlign='center';ctx.fillText('ğŸ’¼ Ä°ÅLERÄ° BULDUNUZ!',W/2,H/2);ctx.textAlign='left';}}

// ===== LEVEL 3 =====
let L3={};
function initL3(){const gY=H-90;L3={gY,cx:0,lW:3000,won:false,col:0,target:15,pl:[{x:0,y:gY,w:3200,h:90}],stars:[],spots:[],p:mkP(60,gY)};
for(let i=0;i<14;i++)L3.pl.push({x:200+i*195+Math.random()*50,y:gY-60-Math.random()*110,w:80+Math.random()*35,h:16});
for(let i=0;i<22;i++)L3.stars.push({x:180+i*125+Math.random()*50,y:80+Math.random()*230,c:false,ang:Math.random()*Math.PI*2});
for(let i=0;i<6;i++)L3.spots.push({x:300+i*450,ang:Math.random()*0.5-0.25,spd:0.005+Math.random()*0.005});}
function updL3(){const p=L3.p;updP(p,L3.gY,L3.pl);if(p.x>L3.lW)p.x=L3.lW;
L3.stars.forEach(s=>{if(s.c)return;s.ang+=0.03;if(Math.abs(p.x+FW/2-s.x)<26&&Math.abs(p.y+FH/2-s.y)<26){s.c=true;L3.col++;spawnP(s.x,s.y,'#FFD700',12);}});
if(L3.col>=L3.target&&!L3.won){L3.won=true;setTimeout(()=>startTr('ending'),2000);}
const tc=p.x-W/3;L3.cx+=(tc-L3.cx)*0.08;L3.cx=Math.max(0,Math.min(L3.cx,L3.lW-W));
document.getElementById('hL').textContent=`â­ ${L3.col} / ${L3.target}`;document.getElementById('hC').textContent='â­ BÃ–LÃœM 3: HAYALLER!';document.getElementById('hR').textContent='';}
function drawL3(){const sg=ctx.createLinearGradient(0,0,0,H);sg.addColorStop(0,'#0a0515');sg.addColorStop(0.5,'#150a20');sg.addColorStop(1,'#1a0a15');ctx.fillStyle=sg;ctx.fillRect(0,0,W,H);
L3.spots.forEach(sp=>{sp.ang+=sp.spd;const sx=sp.x-L3.cx*0.5;ctx.save();ctx.translate(sx,0);ctx.rotate(Math.sin(sp.ang)*0.3);const lg=ctx.createLinearGradient(0,0,0,H);lg.addColorStop(0,'rgba(255,220,150,0.08)');lg.addColorStop(1,'rgba(255,220,150,0)');ctx.fillStyle=lg;ctx.beginPath();ctx.moveTo(-5,0);ctx.lineTo(-80,H);ctx.lineTo(80,H);ctx.lineTo(5,0);ctx.fill();ctx.restore();});
const t=Date.now()*0.001;for(let i=0;i<20;i++){ctx.fillStyle=`rgba(255,215,0,${0.3+0.3*Math.sin(t*3+i)})`;ctx.fillRect((i*173+t*20)%W,(i*97+Math.sin(t+i)*30)%(H*0.7),2,2);}
ctx.fillStyle='#6a1020';ctx.fillRect(0,L3.gY,W,H-L3.gY);ctx.fillStyle='#8a1830';ctx.fillRect(0,L3.gY,W,4);
L3.pl.forEach((pl,i)=>{if(i===0)return;const sx=pl.x-L3.cx;if(sx>W+50||sx+pl.w<-50)return;ctx.fillStyle='#8a6020';ctx.fillRect(sx,pl.y,pl.w,pl.h);ctx.fillStyle='#aa8030';ctx.fillRect(sx,pl.y,pl.w,3);});
L3.stars.forEach(s=>{if(s.c)return;const sx=s.x-L3.cx;if(sx>W+30||sx<-30)return;ctx.save();ctx.translate(sx,s.y);ctx.rotate(s.ang);ctx.fillStyle='#FFD700';ctx.beginPath();for(let i=0;i<5;i++){const a=(i*4*Math.PI/5)-Math.PI/2;ctx.lineTo(Math.cos(a)*10,Math.sin(a)*10);const a2=a+2*Math.PI/10;ctx.lineTo(Math.cos(a2)*4,Math.sin(a2)*4);}ctx.closePath();ctx.fill();ctx.fillStyle='rgba(255,215,0,0.2)';ctx.beginPath();ctx.arc(0,0,16,0,Math.PI*2);ctx.fill();ctx.restore();});
const sx=L3.p.x-L3.cx;drawFatih(sx,L3.p.y,FS,L3.p.face,Math.floor(L3.p.rf),'actor');drawSila(sx-45,L3.p.y+FH-SH,SS,L3.p.face,Math.floor(L3.p.rf),'designer');
ctx.font='7px "Press Start 2P"';ctx.textAlign='center';ctx.fillStyle='#FFD700';ctx.fillText('ğŸ­ OYUNCU FATÄ°H',sx+FW/2,L3.p.y-8);ctx.fillStyle='#80d0ff';ctx.fillText('ğŸ¨ DESIGNER SILA',sx-45+FW/2,L3.p.y+FH-SH-8);ctx.textAlign='left';drawP(L3.cx);
if(L3.won){const a=Math.min(1,(sT-10)*0.02);ctx.fillStyle=`rgba(255,215,0,${a})`;ctx.font='14px "Press Start 2P"';ctx.textAlign='center';ctx.fillText('â­ HAYALLERÄ°NÄ°ZE ULAÅTINIZ! â­',W/2,H/2);ctx.textAlign='left';}}

// ===== ENDING SCENE =====
function drawEnding(){
const sg=ctx.createLinearGradient(0,0,0,H);sg.addColorStop(0,'#050515');sg.addColorStop(0.3,'#0a0a2a');sg.addColorStop(1,'#151030');ctx.fillStyle=sg;ctx.fillRect(0,0,W,H);
const t=Date.now()*0.001;
for(let i=0;i<5;i++){const ax=W/2+Math.sin(t*0.3+i)*200,ay=80+i*20;const ag=ctx.createRadialGradient(ax,ay,10,ax,ay,150);ag.addColorStop(0,`hsla(${(t*20+i*30)%360},60%,50%,0.06)`);ag.addColorStop(1,'transparent');ctx.fillStyle=ag;ctx.fillRect(0,0,W,H*0.5);}
for(let i=0;i<80;i++){ctx.fillStyle=`rgba(255,255,255,${0.3+0.5*Math.sin(t*2+i)})`;ctx.fillRect((i*97)%W,(i*61)%(H*0.6),1.5,1.5);}
ctx.fillStyle='#0a1a0a';ctx.fillRect(0,380,W,120);ctx.fillStyle='#122a12';ctx.fillRect(0,380,W,4);
for(let i=0;i<6;i++){const tx=50+i*140;ctx.fillStyle='#0a180a';ctx.beginPath();ctx.moveTo(tx,380);ctx.lineTo(tx+15,300-i*10);ctx.lineTo(tx+30,380);ctx.fill();}
ctx.fillStyle='#3a2518';ctx.fillRect(320,355,160,8);ctx.fillRect(340,363,6,20);ctx.fillRect(454,363,6,20);ctx.fillRect(325,330,150,6);
drawFatih(415,350-FH+15,FS,'left',0,'rich');drawSila(340,350-SH+15,SS,'right',0,'rich');
const hs=1+Math.sin(t*2)*0.1;ctx.save();ctx.translate(400,265);ctx.scale(hs,hs);drawHeart(0,0,20,'rgba(255,64,129,0.6)');ctx.restore();
for(let i=0;i<8;i++)drawHeart(300+i*30+Math.sin(t+i*0.8)*20,200+Math.cos(t*0.5+i*1.2)*40,6+Math.sin(t+i)*2,`rgba(255,128,180,${0.15+Math.sin(t+i)*0.08})`);
for(let i=0;i<10;i++){const fx=100+i*70+Math.sin(t*0.7+i*2)*30,fy=360+Math.cos(t*0.5+i*1.5)*20,fa=0.3+0.4*Math.sin(t*3+i*4);ctx.fillStyle=`rgba(200,255,100,${fa})`;ctx.beginPath();ctx.arc(fx,fy,2,0,Math.PI*2);ctx.fill();}}

// ===== GIFT REVEAL SCENE =====
function drawGiftReveal(){
const t=Date.now()*0.001;
// Dark elegant background
const sg=ctx.createLinearGradient(0,0,0,H);sg.addColorStop(0,'#0a0515');sg.addColorStop(0.5,'#150a20');sg.addColorStop(1,'#0a0510');
ctx.fillStyle=sg;ctx.fillRect(0,0,W,H);
// Sparkle particles
for(let i=0;i<50;i++){
  const sx=(i*131+t*10)%W,sy=(i*73+Math.sin(t+i)*20)%H;
  const a=0.2+0.4*Math.sin(t*2+i);
  ctx.fillStyle=`rgba(255,215,0,${a})`;ctx.fillRect(sx,sy,2,2);
}
// Spotlight on bag
const sg2=ctx.createRadialGradient(W/2,230,30,W/2,230,200);
sg2.addColorStop(0,'rgba(255,220,180,0.12)');sg2.addColorStop(1,'transparent');
ctx.fillStyle=sg2;ctx.beginPath();ctx.arc(W/2,230,200,0,Math.PI*2);ctx.fill();

// Draw the kilim bag centered, big
const bagScale=3.5;
const bagW=40*2*bagScale, bagH=30*2*bagScale;
const bagX=W/2-bagW/2+20,bagY=150;

// Glow around bag
const bg=ctx.createRadialGradient(W/2,bagY+bagH/2,30,W/2,bagY+bagH/2,120);
bg.addColorStop(0,'rgba(255,100,50,0.12)');bg.addColorStop(1,'transparent');
ctx.fillStyle=bg;ctx.beginPath();ctx.arc(W/2,bagY+bagH/2,120,0,Math.PI*2);ctx.fill();

drawKilimBag(bagX,bagY,bagScale);

// Floating hearts around bag
for(let i=0;i<6;i++){
  const hx=bagX+bagW/2+Math.cos(t+i*Math.PI/3)*100;
  const hy=bagY+bagH/2+Math.sin(t+i*Math.PI/3)*60;
  drawHeart(hx,hy,5+Math.sin(t+i)*2,`rgba(255,128,180,${0.3+Math.sin(t+i)*0.1})`);
}

// Text
ctx.textAlign='center';
ctx.font='11px "Press Start 2P"';
ctx.fillStyle='#ff80ab';
ctx.shadowColor='rgba(255,64,129,0.5)';ctx.shadowBlur=10;
ctx.fillText('ğŸ HEDÄ°YENÄ°ZÄ°N SIRADAKÄ° AÅAMASINA',W/2,380);
ctx.fillText('GEÃ‡MEYE HAK KAZANDINIZ BEYBÄ°! ğŸ',W/2,400);
ctx.shadowBlur=0;

ctx.font='8px "Press Start 2P"';
ctx.fillStyle='#aa8830';
ctx.fillText('2040 yÄ±lÄ±ndaki designer SÄ±la\'nÄ±n elinin tozu olmayacak',W/2,430);
ctx.fillText('ama yine de gÃ¼zel gÃ¶zÃ¼kecek bu Ã§anta',W/2,445);
ctx.fillText('en kÄ±sa zamanda fiziksel olarak sizinle olacaktÄ±r ğŸ’•',W/2,460);

ctx.textAlign='left';

// Blink restart hint
if(Math.floor(t)%2===0){
  ctx.textAlign='center';ctx.font='7px "Press Start 2P"';ctx.fillStyle='#666';
  ctx.fillText('ENTER ile tekrar oyna',W/2,488);ctx.textAlign='left';
}
}

// ===== TITLE =====
function drawTitle(){
const sg=ctx.createLinearGradient(0,0,0,H);sg.addColorStop(0,'#0a0515');sg.addColorStop(0.5,'#1a0a25');sg.addColorStop(1,'#0a0515');ctx.fillStyle=sg;ctx.fillRect(0,0,W,H);
const t=Date.now()*0.001;
for(let i=0;i<60;i++){ctx.fillStyle=`rgba(255,200,220,${0.3+0.5*Math.sin(t*2+i)})`;ctx.fillRect((i*131)%W,(i*73)%H,2,2);}
for(let i=0;i<12;i++)drawHeart((i*70+t*15)%W,H-((i*50+t*30)%(H+50)),4+i%3,`rgba(255,64,129,${0.08+(i%3)*0.03})`);
drawSila(280,260,2.0,'right',Math.floor(t)%2,'normal');drawFatih(430,255,2.0,'left',Math.floor(t)%2,'normal');
const hs=1+Math.sin(t*2)*0.15;ctx.save();ctx.translate(390,290);ctx.scale(hs,hs);drawHeart(0,0,15,'#ff4081');ctx.restore();
ctx.textAlign='center';ctx.font='22px "Press Start 2P"';ctx.fillStyle='#ff4081';ctx.shadowColor='rgba(255,64,129,0.5)';ctx.shadowBlur=20;ctx.fillText('SILA & FATÄ°H',W/2,80);
ctx.font='12px "Press Start 2P"';ctx.fillStyle='#ff80ab';ctx.fillText('BÄ°ZÄ°M HÄ°KAYEMÄ°Z',W/2,115);ctx.shadowBlur=0;
ctx.font='9px "Press Start 2P"';ctx.fillStyle='#aa6080';ctx.fillText('ğŸ’• Sevgililer GÃ¼nÃ¼ 2026 ğŸ’•',W/2,150);
if(Math.floor(t)%2===0){ctx.font='10px "Press Start 2P"';ctx.fillStyle='#fff';ctx.fillText('ğŸ® ENTER ile baÅŸla ğŸ®',W/2,440);}
ctx.textAlign='left';}

// ===== TRANSITIONS =====
function startTr(tgt){tr={a:true,al:0,tgt,fi:true};}
function updTr(){if(!tr.a)return;if(tr.fi){tr.al+=0.03;if(tr.al>=1){tr.fi=false;switchSt(tr.tgt);}}else{tr.al-=0.03;if(tr.al<=0)tr.a=false;}}
function drawTr(){if(!tr.a)return;ctx.fillStyle=`rgba(0,0,0,${tr.al})`;ctx.fillRect(0,0,W,H);}

function switchSt(s){
state=s;sT=0;dI=0;
document.getElementById('hL').textContent='';document.getElementById('hC').textContent='';document.getElementById('hR').textContent='';
switch(s){case 'l1':initL1();break;case 'c2':initL2();break;case 'l2':initL2();break;case 'c3':initL3();break;case 'l3':initL3();break;}}

function getDlg(){switch(state){case 'mansion':return DLG.mansion;case 'flat':return DLG.flat;case 'train':return DLG.train;case 'c1':return DLG.c1;case 'c2':return DLG.c2;case 'c3':return DLG.c3;case 'ending':return DLG.ending;case 'gift':return DLG.gift;}return null;}

function handleInput(code){
if(tr.a)return;
if(state==='title'&&(code==='Enter'||code==='Space')){startTr('mansion');return;}
if(state==='giftReveal'&&(code==='Enter'||code==='Space')){startTr('title');return;}
const dl=getDlg();
if(dl&&(code==='Enter'||code==='Space')){
  const d=dl[dI];if(!d)return;
  if(Math.floor(sT/2)<d.t.length){sT=d.t.length*2+10;return;}
  dI++;sT=0;
  if(dI>=dl.length){
    switch(state){
      case 'mansion':startTr('flat');break;
      case 'flat':startTr('train');break;
      case 'train':startTr('c1');break;
      case 'c1':startTr('l1');break;
      case 'c2':startTr('l2');break;
      case 'c3':startTr('l3');break;
      case 'ending':startTr('gift');break;
      case 'gift':startTr('giftReveal');break;
    }
  }
}}

function loop(){
sT++;aT++;if(aT%10===0)aF++;
if(!tr.a){switch(state){case 'l1':updL1();break;case 'l2':updL2();break;case 'l3':updL3();break;}}
updTr();
switch(state){
  case 'title':drawTitle();break;
  case 'mansion':drawMansion();break;
  case 'flat':drawFlat();break;
  case 'train':drawTrain();break;
  case 'c1':drawTrain();break;
  case 'l1':drawL1();break;
  case 'c2':drawL2();break;case 'l2':drawL2();break;
  case 'c3':drawL3();break;case 'l3':drawL3();break;
  case 'ending':drawEnding();break;
  case 'gift':drawEnding();break;
  case 'giftReveal':drawGiftReveal();break;
}
const dl=getDlg();if(dl&&dI<dl.length)drawDlg(dl[dI]);
drawTr();requestAnimationFrame(loop);}
loop();
</script>
</body>
</html>
